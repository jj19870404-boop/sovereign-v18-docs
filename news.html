<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="strict-origin-when-cross-origin">
<title>Sovereign V24 - 美股整點快報</title>
<meta name="description" content="Sovereign V24 美股整點財經快報 — 每小時自動更新市場動態，AI 智慧分析摘要，涵蓋財報、Fed 政策、產業趨勢等重點新聞，掌握影響交易的關鍵資訊。">
<meta property="og:title" content="Sovereign V24 - 美股整點快報">
<meta property="og:description" content="Sovereign V24 美股整點財經快報 — 每小時自動更新、AI 分析摘要、市場重點新聞">
<meta property="og:type" content="website">
<meta property="og:url" content="https://jj19870404-boop.github.io/sovereign-v18-docs/news.html">
<meta property="og:image" content="https://jj19870404-boop.github.io/sovereign-v18-docs/images/sovereign_v18_20260211.png">
<meta property="og:image:width" content="1080">
<meta property="og:image:height" content="1350">
<meta property="og:locale" content="zh_TW">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Sovereign V24 - 美股整點快報">
<meta name="twitter:description" content="Sovereign V24 美股整點財經快報 — 每小時自動更新、AI 分析摘要、市場重點新聞">
<meta name="twitter:image" content="https://jj19870404-boop.github.io/sovereign-v18-docs/images/sovereign_v18_20260211.png">
<link rel="canonical" href="https://jj19870404-boop.github.io/sovereign-v18-docs/news.html">
<link rel="icon" type="image/png" href="images/sovereign_v18_20260211.png">
<link rel="apple-touch-icon" href="images/sovereign_v18_20260211.png">
<meta name="theme-color" content="#0f1117">
<link rel="preload" href="data/news-index.json" as="fetch" crossorigin>
<style>
:root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #222633;
    --border: #2d3148;
    --text: #e1e4ed;
    --text-dim: #8b90a5;
    --accent: #6c8cff;
    --accent2: #4ecdc4;
    --green: #4ecb71;
    --red: #ff6b6b;
    --yellow: #ffd93d;
    --orange: #ff9f43;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    font-size: 15px;
    -webkit-text-size-adjust: 100%;
    overscroll-behavior: contain;
}
.container { max-width: 860px; margin: 0 auto; padding: 24px; }

/* ── Top Nav ── */
.top-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 24px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 8px;
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(15, 17, 23, 0.92);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    margin-left: -24px;
    margin-right: -24px;
}
.top-nav a {
    color: var(--accent);
    text-decoration: none;
    font-size: 0.9em;
}
.top-nav a:hover { text-decoration: underline; }
.top-nav .brand {
    font-weight: 700;
    color: var(--text-dim);
    font-size: 0.9em;
}
.top-nav .brand:hover { color: var(--text); text-decoration: none; }
.nav-links { display: flex; gap: 16px; flex-wrap: wrap; }
.nav-links a.active { color: var(--text); font-weight: 600; }
.menu-toggle { display: none; background: none; border: none; color: var(--text); font-size: 1.5em; cursor: pointer; padding: 4px 8px; }

/* ── Stale Banner ── */
.stale-banner {
    background: linear-gradient(135deg, #ff9f43, #ee5a24);
    color: #fff;
    padding: 10px 20px;
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    margin-bottom: 16px;
    position: relative;
    display: none;
}
.stale-banner .close-btn {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: rgba(255,255,255,0.8);
    font-size: 18px;
    cursor: pointer;
    padding: 4px 8px;
}
.stale-banner .close-btn:hover { color: #fff; }

/* ── Title ── */
h1 {
    font-size: 1.8em;
    text-align: center;
    margin-bottom: 24px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* ── Date Navigation ── */
.date-nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    margin-bottom: 28px;
}
.date-nav button {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--accent);
    width: 40px;
    height: 40px;
    border-radius: 8px;
    font-size: 1.1em;
    cursor: pointer;
    transition: background 0.2s;
}
.date-nav button:hover:not(:disabled) { background: var(--surface2); }
.date-nav button:disabled { opacity: 0.3; cursor: default; }
.date-label {
    font-size: 1.3em;
    font-weight: 700;
    color: var(--text);
    min-width: 160px;
    text-align: center;
}

/* ── Summary Bar ── */
.summary-bar {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-bottom: 28px;
    flex-wrap: wrap;
}
.summary-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9em;
    color: var(--text-dim);
}
.summary-value {
    font-weight: 700;
    color: var(--accent);
    font-size: 1.1em;
}

/* ── News Card ── */
.hour-group {
    margin-bottom: 24px;
}
.hour-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
}
.hour-time {
    font-size: 1.1em;
    font-weight: 700;
    color: var(--accent);
    min-width: 52px;
}
.hour-tag {
    font-size: 0.75em;
    color: var(--text-dim);
    background: var(--surface2);
    padding: 2px 8px;
    border-radius: 4px;
}

.news-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px 18px;
    margin-bottom: 10px;
    transition: border-color 0.2s;
}
.news-card:hover {
    border-color: var(--accent);
}
.news-headline {
    font-size: 0.95em;
    line-height: 1.7;
    color: var(--text);
    margin-bottom: 8px;
}
.news-impact {
    font-size: 0.85em;
    line-height: 1.6;
    color: var(--accent2);
    padding-left: 12px;
    border-left: 2px solid var(--accent2);
}
.news-idx {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 4px;
    background: var(--surface2);
    color: var(--text-dim);
    font-size: 0.7em;
    font-weight: 700;
    margin-right: 8px;
    flex-shrink: 0;
    vertical-align: middle;
}

/* ── State Message ── */
.state-msg {
    text-align: center;
    padding: 48px 16px;
    color: var(--text-dim);
}
.state-msg .icon { font-size: 2.4em; margin-bottom: 12px; }

/* ── Footer ── */
.footer {
    text-align: center;
    color: var(--text-dim);
    font-size: 0.8em;
    margin-top: 40px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
}

/* ── Responsive ── */
@media (max-width: 768px) {
    .container { padding: 16px; }
    .menu-toggle { display: block; }
    .nav-links { display: none; width: 100%; flex-direction: column; gap: 8px; padding-top: 8px; }
    .nav-links.open { display: flex; }
}
@media (max-width: 600px) {
    .container { padding: 12px; }
    h1 { font-size: 1.4em; }
    .date-label { font-size: 1.1em; min-width: 130px; }
    .summary-bar { gap: 8px; }
    .summary-item { font-size: 0.82em; }
    .news-card { padding: 12px 14px; }
    .news-headline { font-size: 0.9em; }
    .news-impact { font-size: 0.8em; }
    .hour-time { font-size: 1em; }
}

/* ── Scroll to Top ── */
.scroll-top {
    position: fixed; bottom: 28px; right: 28px; width: 44px; height: 44px;
    border-radius: 50%; background: var(--accent); color: var(--bg); border: none;
    font-size: 1.3em; cursor: pointer; opacity: 0; visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s, transform 0.2s; z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center;
}
.scroll-top.show { opacity: 1; visibility: visible; }
.scroll-top:hover { transform: scale(1.1); }
.skip-nav {
    position: absolute;
    left: -9999px;
    top: auto;
    width: 1px;
    height: 1px;
    overflow: hidden;
    z-index: 999;
    padding: 0.5rem 1rem;
    background: var(--accent);
    color: #fff;
    text-decoration: none;
    border-radius: 4px;
}
.skip-nav:focus {
    position: fixed;
    left: 1rem;
    top: 1rem;
    width: auto;
    height: auto;
    overflow: visible;
}

/* ── Accessibility ── */
:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
    border-radius: 4px;
}
:focus:not(:focus-visible) { outline: none; }
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        transition-duration: 0.01ms !important;
    }
}
@media print {
    body { background: #fff !important; color: #000 !important; }
    .top-nav, .scroll-top, .skip-nav, .menu-toggle { display: none !important; }
    .container { max-width: 100%; padding: 0; }
    .card { border: 1px solid #ccc; break-inside: avoid; }
    a { color: #000 !important; }
    table { font-size: 0.85em; }
}
</style>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","name":"Sovereign V24 - 美股整點快報","description":"Sovereign V24 美股整點財經快報 — 每小時自動更新、AI 分析摘要、市場重點新聞","url":"https://jj19870404-boop.github.io/sovereign-v18-docs/news.html","inLanguage":"zh-TW","isPartOf":{"@type":"WebSite","name":"Sovereign V24","url":"https://jj19870404-boop.github.io/sovereign-v18-docs/"}}
</script>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"首頁","item":"https://jj19870404-boop.github.io/sovereign-v18-docs/"},{"@type":"ListItem","position":2,"name":"整點快報","item":"https://jj19870404-boop.github.io/sovereign-v18-docs/news.html"}]}
</script>
</head>
<body>
<a href="#main-content" class="skip-nav">跳至主要內容</a>
<div class="container">

<!-- Top Nav -->
<div class="top-nav" role="navigation" aria-label="主要導航">
    <a href="index.html" class="brand">Sovereign V24</a>
    <button class="menu-toggle" aria-label="開啟選單" aria-expanded="false">&#9776;</button>
    <div class="nav-links">
        <a href="index.html">首頁</a>
        <a href="picks.html">每日選股</a>
        <a href="track.html">選股追蹤</a>
        <a href="news.html" class="active">整點快報</a>
        <a href="evolution.html">版本演化</a>
        <a href="backtest.html">回測報告</a>
    </div>
</div>

<main id="main-content" role="main">
<noscript><div style="padding:20px;text-align:center;color:#8b90a5;background:#1a1d27;border-radius:8px;margin:20px 0;">本頁面需要 JavaScript 才能顯示新聞內容。請啟用 JavaScript 後重新整理。</div></noscript>
<div class="stale-banner" id="stale-banner">
    <span id="stale-msg"></span>
    <button class="close-btn" aria-label="關閉">&times;</button>
</div>

<h1>美股整點財經快報</h1>

<!-- Date Navigation -->
<div class="date-nav">
    <button id="btn-prev">&larr;</button>
    <span class="date-label" id="date-label">--</span>
    <button id="btn-next">&rarr;</button>
</div>

<!-- Summary -->
<div class="summary-bar" id="summary">
    <div class="summary-item">
        <span>更新次數</span>
        <span class="summary-value" id="s-total">--</span>
    </div>
    <div class="summary-item">
        <span>新聞重點</span>
        <span class="summary-value" id="s-items">--</span>
    </div>
    <div class="summary-item">
        <span>時間範圍</span>
        <span class="summary-value" id="s-range">--</span>
    </div>
</div>

<!-- News Container -->
<div id="news-container" role="region" aria-live="polite" aria-label="最新快報"></div>

<!-- Footer -->
<div class="footer">
    <a href="index.html" style="color:var(--accent);text-decoration:none">&larr; 系統文件</a> &nbsp;|&nbsp;
    <a href="picks.html" style="color:var(--accent);text-decoration:none">每日選股</a> &nbsp;|&nbsp;
    <a href="track.html" style="color:var(--accent);text-decoration:none">選股追蹤</a> &nbsp;|&nbsp;
    <a href="evolution.html" style="color:var(--accent);text-decoration:none">版本演化</a>
    <p style="margin-top:8px">Sovereign V24 News &mdash; 資料來源: CNBC, Reuters, MarketWatch, Yahoo Finance, Bloomberg 等</p>
    <p style="margin-top:4px">由 Gemini AI 分析摘要 | 每小時整點自動更新</p>
    <p id="site-updated" style="margin-top:6px;font-size:0.8em;color:var(--text-dim)"></p>
</div>

</div>

<script>
const $ = id => document.getElementById(id);
const BASE = 'data/';

let dateIndex = [];
let currentIdx = 0;

// ── Freshness Check ──────────────────────────────
function checkNewsFreshness(latestDate) {
    const now = new Date();
    const todayStr = now.getFullYear() + '-' + String(now.getMonth()+1).padStart(2,'0') + '-' + String(now.getDate()).padStart(2,'0');
    if (latestDate < todayStr) {
        const banner = $('stale-banner');
        const msg = $('stale-msg');
        msg.textContent = `快報尚未更新至今天（最新: ${latestDate}，今天: ${todayStr}）`;
        banner.style.display = 'block';
    }
}
function checkNewsPostFreshness(posts) {
    if (!posts || posts.length === 0) return;
    const latest = posts[0].timestamp;
    if (!latest) return;
    const ts = new Date(latest);
    const ageH = (Date.now() - ts.getTime()) / 3600000;
    if (ageH > 2) {
        const banner = $('stale-banner');
        const msg = $('stale-msg');
        const timeStr = ts.toLocaleTimeString('zh-TW', {hour:'2-digit',minute:'2-digit'});
        msg.textContent = `快報已超過 2 小時未更新（最後更新: ${timeStr}，${ageH.toFixed(0)} 小時前）`;
        banner.style.display = 'block';
    }
}

// ── Init ────────────────────────────────────────
async function init() {
    showState('載入中...', '正在讀取新聞索引');
    try {
        const res = await fetch(BASE + 'news-index.json?t=' + Date.now());
        if (!res.ok) throw new Error('Index not found');
        dateIndex = await res.json();
        if (dateIndex.length === 0) {
            showState('尚無新聞資料', '新聞資料尚未生成');
            return;
        }
        checkNewsFreshness(dateIndex[0]);
        // Check hash
        const hash = window.location.hash.slice(1);
        const idx = dateIndex.indexOf(hash);
        currentIdx = idx >= 0 ? idx : 0;
        loadDate();
    } catch(e) {
        showState('無法載入', '請確認 data/news-index.json 是否存在');
    }
}

// ── Navigation ──────────────────────────────────
function nav(dir) {
    const next = currentIdx + dir;
    if (next < 0 || next >= dateIndex.length) return;
    currentIdx = next;
    loadDate();
}

function updateNav() {
    $('btn-prev').disabled = currentIdx <= 0;
    $('btn-next').disabled = currentIdx >= dateIndex.length - 1;
}

// ── Load Date ───────────────────────────────────
async function loadDate() {
    const date = dateIndex[currentIdx];
    $('date-label').textContent = date;
    window.location.hash = date;
    updateNav();

    try {
        const res = await fetch(BASE + `news-${date}.json?t=${Date.now()}`);
        if (!res.ok) throw new Error('Not found');
        const data = await res.json();
        renderAll(data);
    } catch(e) {
        showState('無法載入', `找不到 ${date} 的新聞資料`);
    }
}

// ── Render ───────────────────────────────────────
function renderAll(data) {
    const posts = data.posts || [];
    // Check post freshness only when viewing latest date
    if (currentIdx === 0) checkNewsPostFreshness(posts);

    // Summary
    const totalPosts = posts.length;
    const totalItems = posts.reduce((s, p) => s + (p.items ? p.items.length : 0), 0);
    $('s-total').textContent = totalPosts;
    $('s-items').textContent = totalItems;

    if (posts.length > 0) {
        const first = posts[posts.length - 1].time || '--';
        const last = posts[0].time || '--';
        $('s-range').textContent = `${first} ~ ${last}`;
    } else {
        $('s-range').textContent = '--';
    }

    // News cards
    const container = $('news-container');
    if (posts.length === 0) {
        container.innerHTML = '<div class="state-msg"><div class="icon">&#x1F4F0;</div><p>今日尚無新聞</p></div>';
        return;
    }

    container.innerHTML = posts.map(post => {
        const time = post.time || '--:--';
        const items = post.items || [];

        const cards = items.map((item, i) => {
            const headline = item.headline || '';
            const impact = item.impact || '';
            return `<div class="news-card">
                <div class="news-headline"><span class="news-idx">${i + 1}</span>${escHtml(headline)}</div>
                ${impact ? `<div class="news-impact">${escHtml(impact)}</div>` : ''}
            </div>`;
        }).join('');

        return `<div class="hour-group">
            <div class="hour-header">
                <span class="hour-time">${time}</span>
                <span class="hour-tag">${items.length} 則重點</span>
            </div>
            ${cards}
        </div>`;
    }).join('');
}

function escHtml(str) {
    if (str == null) return '';
    const div = document.createElement('div');
    div.textContent = String(str);
    return div.innerHTML;
}

// ── State Message ───────────────────────────────
function showState(title, desc) {
    $('s-total').textContent = '--';
    $('s-items').textContent = '--';
    $('s-range').textContent = '--';
    $('news-container').innerHTML = `<div class="state-msg">
        <div class="icon">&#x1F4F0;</div>
        <p><strong>${escHtml(title)}</strong></p>
        <p style="margin-top:8px;font-size:0.9em">${escHtml(desc)}</p>
    </div>`;
}

// ── Bootstrap ───────────────────────────────────
init();
window.addEventListener('hashchange', () => {
    const hash = window.location.hash.slice(1);
    const idx = dateIndex.indexOf(hash);
    if (idx >= 0 && idx !== currentIdx) {
        currentIdx = idx;
        loadDate();
    }
});

// ── Site Info: 更新時間戳 + Nav Brand ──
// Mobile hamburger menu toggle
document.querySelector('.menu-toggle')?.addEventListener('click', function() {
    const nav = document.querySelector('.nav-links');
    const open = nav.classList.toggle('open');
    this.setAttribute('aria-expanded', open);
    this.innerHTML = open ? '&times;' : '&#9776;';
});
fetch('data/site-info.json?t='+Date.now()).then(r=>r.json()).then(info=>{
    const b=document.querySelector('.brand');if(b)b.textContent=info.label;
    const ts=info.updated&&info.updated.news;
    if(ts){const d=new Date(ts);document.getElementById('site-updated').textContent='最後更新：'+d.toLocaleDateString('zh-TW',{year:'numeric',month:'2-digit',day:'2-digit'})+' '+d.toLocaleTimeString('zh-TW',{hour:'2-digit',minute:'2-digit',hour12:false});}
}).catch(()=>{});
document.querySelector('.close-btn')?.addEventListener('click',function(){this.parentElement.style.display='none';});
document.getElementById('btn-prev')?.addEventListener('click',()=>nav(-1));
document.getElementById('btn-next')?.addEventListener('click',()=>nav(1));
</script>
</main>
<button class="scroll-top" id="scrollTop" aria-label="回到頂部">&uarr;</button>
<script>
const scrollBtn = document.getElementById('scrollTop');
if(scrollBtn) scrollBtn.addEventListener('click', () => window.scrollTo({top:0,behavior:'smooth'}));
window.addEventListener('scroll', () => { scrollBtn.classList.toggle('show', window.scrollY > 300); });
</script>
</body>
</html>
