<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="strict-origin-when-cross-origin">
<title>Sovereign V25 - 選股歷史追蹤</title>
<meta name="description" content="Sovereign V25 選股歷史追蹤 — 每日 Rank#1 選股的後續表現追蹤、勝率統計分析、100 個交易日走勢記錄，驗證系統選股準確度與實戰可靠性。">
<meta property="og:title" content="Sovereign V25 - 選股歷史追蹤">
<meta property="og:description" content="Sovereign V25 選股歷史追蹤 — 每日 #1 選股後續表現、勝率統計、100 個交易日追蹤">
<meta property="og:type" content="website">
<meta property="og:url" content="https://jj19870404-boop.github.io/sovereign-v18-docs/track.html">
<meta property="og:image" content="https://jj19870404-boop.github.io/sovereign-v18-docs/images/sovereign_v18_20260211.png">
<meta property="og:image:width" content="1080">
<meta property="og:image:height" content="1350">
<meta property="og:locale" content="zh_TW">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Sovereign V25 - 選股歷史追蹤">
<meta name="twitter:description" content="Sovereign V25 選股歷史追蹤 — 每日 #1 選股後續表現、勝率統計、100 個交易日追蹤">
<meta name="twitter:image" content="https://jj19870404-boop.github.io/sovereign-v18-docs/images/sovereign_v18_20260211.png">
<link rel="canonical" href="https://jj19870404-boop.github.io/sovereign-v18-docs/track.html">
<link rel="icon" type="image/png" href="images/sovereign_v18_20260211.png">
<link rel="apple-touch-icon" href="images/sovereign_v18_20260211.png">
<meta name="theme-color" content="#0f1117">
<link rel="preload" href="data/track.json" as="fetch" crossorigin>
<style>
:root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #222633;
    --border: #2d3148;
    --text: #e1e4ed;
    --text-dim: #8b90a5;
    --accent: #6c8cff;
    --accent2: #4ecdc4;
    --green: #4ecb71;
    --red: #ff6b6b;
    --yellow: #ffd93d;
    --orange: #ff9f43;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; overscroll-behavior: contain; scroll-padding-top: 60px; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    font-size: 15px;
    -webkit-text-size-adjust: 100%;
}
.container { max-width: 960px; margin: 0 auto; padding: 24px; }

/* ── Top Nav ── */
.top-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 24px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 8px;
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(15, 17, 23, 0.92);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    margin-left: -24px;
    margin-right: -24px;
}
.top-nav a {
    color: var(--accent);
    text-decoration: none;
    font-size: 0.9em;
}
.top-nav a:hover { text-decoration: underline; }
.top-nav .brand {
    font-weight: 700;
    color: var(--text-dim);
    font-size: 0.9em;
}
.top-nav .brand:hover { color: var(--text); text-decoration: none; }
.nav-links { display: flex; gap: 16px; flex-wrap: wrap; }
.nav-links a.active { color: var(--text); font-weight: 600; }
.menu-toggle { display: none; background: none; border: none; color: var(--text); font-size: 1.5em; cursor: pointer; padding: 4px 8px; }

/* ── Stale Banner ── */
.stale-banner {
    background: linear-gradient(135deg, #ff9f43, #ee5a24);
    color: #fff;
    padding: 10px 20px;
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    margin-bottom: 16px;
    position: relative;
    display: none;
}
.stale-banner .close-btn {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: rgba(255,255,255,0.8);
    font-size: 18px;
    cursor: pointer;
    padding: 4px 8px;
}
.stale-banner .close-btn:hover { color: #fff; }

/* ── Title ── */
h1 {
    font-size: 1.8em;
    text-align: center;
    margin-bottom: 8px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}
.subtitle {
    text-align: center;
    color: var(--text-dim);
    font-size: 0.9em;
    margin-bottom: 24px;
}

/* ── Summary Cards ── */
.summary {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 28px;
}
.summary-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    text-align: center;
}
.summary-card .label {
    font-size: 0.75em;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}
.summary-card .value {
    font-size: 1.6em;
    font-weight: 700;
}
.summary-card .value.green { color: var(--green); }
.summary-card .value.red { color: var(--red); }
.summary-card .value.accent { color: var(--accent); }

/* ── Table ── */
.track-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
}
.track-table th {
    background: var(--surface);
    color: var(--text-dim);
    font-size: 0.75em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 10px 8px;
    text-align: left;
    border-bottom: 2px solid var(--border);
}
.track-table td {
    padding: 10px 8px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
}
.track-table tr:hover { background: var(--surface); }
.track-table .sym {
    font-weight: 700;
    color: var(--accent);
}
.track-table .mono {
    font-family: 'SF Mono', 'Consolas', monospace;
    font-size: 0.9em;
}

/* ── Status Badges ── */
.badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: 600;
}
.badge-win {
    background: rgba(78, 203, 113, 0.15);
    color: var(--green);
}
.badge-loss {
    background: rgba(255, 107, 107, 0.15);
    color: var(--red);
}
.badge-open {
    background: rgba(255, 217, 61, 0.15);
    color: var(--yellow);
}
.badge-be {
    background: rgba(139, 144, 165, 0.15);
    color: var(--text-dim);
}
.badge-pending {
    background: rgba(108, 140, 255, 0.15);
    color: var(--accent);
}

/* ── Return Color ── */
.ret-pos { color: var(--green); font-weight: 600; }
.ret-neg { color: var(--red); font-weight: 600; }
.ret-zero { color: var(--text-dim); }

/* ── Grade Badges ── */
.grade {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 0.8em;
    font-weight: 700;
    min-width: 28px;
    text-align: center;
}
.grade-S {
    background: linear-gradient(135deg, #ffd700, #ffaa00);
    color: #1a1a00;
}
.grade-A {
    background: rgba(78, 203, 113, 0.2);
    color: var(--green);
    border: 1px solid rgba(78, 203, 113, 0.3);
}
.grade-B {
    background: rgba(108, 140, 255, 0.15);
    color: var(--accent);
    border: 1px solid rgba(108, 140, 255, 0.25);
}
.grade-C {
    background: rgba(255, 159, 67, 0.15);
    color: var(--orange);
    border: 1px solid rgba(255, 159, 67, 0.25);
}
.grade-D {
    background: rgba(255, 107, 107, 0.15);
    color: var(--red);
    border: 1px solid rgba(255, 107, 107, 0.25);
}

/* ── Grade Stats Section ── */
.grade-stats {
    margin-bottom: 24px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
}
.grade-stats h3 {
    font-size: 1em;
    color: var(--text);
    margin-bottom: 12px;
}
.grade-stats-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85em;
}
.grade-stats-table th {
    background: var(--surface2);
    color: var(--text-dim);
    font-size: 0.75em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 8px 6px;
    text-align: center;
    border-bottom: 1px solid var(--border);
}
.grade-stats-table td {
    padding: 8px 6px;
    text-align: center;
    border-bottom: 1px solid var(--border);
}
.grade-stats-note {
    color: var(--text-dim);
    font-size: 0.78em;
    margin-top: 10px;
}

/* ── Footer ── */
.footer {
    text-align: center;
    margin-top: 32px;
    padding: 16px;
    color: var(--text-dim);
    font-size: 0.8em;
    border-top: 1px solid var(--border);
}

/* ── Table Wrap ── */
.table-wrap {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border-radius: 8px;
    border: 1px solid var(--border);
}
.table-wrap .track-table {
    min-width: 600px;
}
/* Sticky symbol + grade columns on horizontal scroll */
.track-table td:nth-child(3),
.track-table th:nth-child(3) {
    position: sticky;
    left: 0;
    z-index: 2;
    background: var(--bg);
}
.track-table tr:hover td:nth-child(3) {
    background: var(--surface);
}
.track-table td:nth-child(4),
.track-table th:nth-child(4) {
    text-align: center;
}

/* ── Loading ── */
.loading {
    text-align: center;
    padding: 60px;
    color: var(--text-dim);
}

/* ── Scroll to Top ── */
.scroll-top {
    position: fixed;
    bottom: 28px;
    right: 28px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--accent);
    color: var(--bg);
    border: none;
    font-size: 1.3em;
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s, transform 0.2s;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
}
.scroll-top.show { opacity: 1; visibility: visible; }
.scroll-top:hover { transform: scale(1.1); }
.skip-nav {
    position: absolute;
    left: -9999px;
    top: auto;
    width: 1px;
    height: 1px;
    overflow: hidden;
    z-index: 999;
    padding: 0.5rem 1rem;
    background: var(--accent);
    color: #fff;
    text-decoration: none;
    border-radius: 4px;
}
.skip-nav:focus {
    position: fixed;
    left: 1rem;
    top: 1rem;
    width: auto;
    height: auto;
    overflow: visible;
}

/* ── Responsive ── */
@media (max-width: 768px) {
    .container { padding: 16px; }
    .summary { gap: 8px; }
    .summary-card .value { font-size: 1.3em; }
    .summary-card { padding: 12px; }
    .track-table { font-size: 0.85em; }
    .track-table th, .track-table td { padding: 8px 6px; }
    .menu-toggle { display: block; }
    .nav-links { display: none; width: 100%; flex-direction: column; gap: 8px; padding-top: 8px; }
    .nav-links.open { display: flex; }
}
@media (max-width: 600px) {
    .summary { grid-template-columns: repeat(2, 1fr); }
    h1 { font-size: 1.4em; }
    .track-table { font-size: 0.78em; }
    .track-table th, .track-table td { padding: 6px 3px; }
    .hide-mobile { display: none; }
    .scroll-top { bottom: 16px; right: 16px; }
    .badge { padding: 2px 6px; font-size: 0.7em; }
}

/* ── Accessibility ── */
:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
    border-radius: 4px;
}
:focus:not(:focus-visible) { outline: none; }
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        transition-duration: 0.01ms !important;
    }
    html { scroll-behavior: auto; }
}
@media print {
    body { background: #fff !important; color: #000 !important; }
    .top-nav, .scroll-top, .skip-nav, .menu-toggle { display: none !important; }
    .container { max-width: 100%; padding: 0; }
    .card { border: 1px solid #ccc; break-inside: avoid; }
    a { color: #000 !important; }
    table { font-size: 0.85em; }
}
</style>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","name":"Sovereign V25 - 選股歷史追蹤","description":"Sovereign V25 選股歷史追蹤 — 每日 #1 選股後續表現、勝率統計、100 個交易日追蹤","url":"https://jj19870404-boop.github.io/sovereign-v18-docs/track.html","inLanguage":"zh-TW","isPartOf":{"@type":"WebSite","name":"Sovereign V25","url":"https://jj19870404-boop.github.io/sovereign-v18-docs/"}}
</script>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"首頁","item":"https://jj19870404-boop.github.io/sovereign-v18-docs/"},{"@type":"ListItem","position":2,"name":"選股追蹤","item":"https://jj19870404-boop.github.io/sovereign-v18-docs/track.html"}]}
</script>
</head>
<body>
<a href="#main-content" class="skip-nav">跳至主要內容</a>
<div class="container">

<!-- Top Nav -->
<div class="top-nav" role="navigation" aria-label="主要導航">
    <a href="index.html" class="brand">Sovereign V25</a>
    <button class="menu-toggle" aria-label="開啟選單" aria-expanded="false">&#9776;</button>
    <div class="nav-links">
        <a href="index.html">首頁</a>
        <a href="picks.html">每日選股</a>
        <a href="track.html" class="active">選股追蹤</a>
        <a href="news.html">整點快報</a>
        <a href="evolution.html">版本演化</a>
        <a href="backtest.html">回測報告</a>
    </div>
</div>

<main id="main-content" role="main">
<noscript><div style="padding:20px;text-align:center;color:#8b90a5;background:#1a1d27;border-radius:8px;margin:20px 0;">本頁面需要 JavaScript 才能顯示追蹤數據。請啟用 JavaScript 後重新整理。</div></noscript>
<div class="stale-banner" id="stale-banner">
    <span id="stale-msg"></span>
    <button class="close-btn" aria-label="關閉">&times;</button>
</div>

<h1>選股歷史追蹤</h1>
<p class="subtitle" id="subtitle">載入中...</p>

<!-- Summary -->
<div class="summary" id="summary">
    <div class="summary-card"><div class="label">勝率</div><div class="value" id="s-wr">--</div></div>
    <div class="summary-card"><div class="label">勝 / 敗</div><div class="value" id="s-wl">--</div></div>
    <div class="summary-card"><div class="label">平均報酬</div><div class="value" id="s-avg">--</div></div>
    <div class="summary-card"><div class="label">持倉中</div><div class="value" id="s-open">--</div></div>
</div>

<!-- Grade Stats -->
<div class="grade-stats" id="grade-stats" role="region" aria-live="polite" aria-label="等級統計" style="display:none;">
    <h3>評級勝率參考 — V25 回測統計 (全美股 11,000+, 452 筆交易, 原始 ATR 止損距離分級)</h3>
    <div style="overflow-x:auto">
    <table class="grade-stats-table" id="grade-stats-table">
        <thead><tr>
            <th>評級</th><th>SL% 條件</th><th>交易數</th><th>勝率</th><th>停利率</th><th>平均報酬</th><th>說明</th>
        </tr></thead>
        <tbody id="grade-stats-body"></tbody>
    </table>
    </div>

    <h3 style="margin-top:20px">各年度評級勝率</h3>
    <div style="overflow-x:auto">
    <table class="grade-stats-table" id="yearly-grade-table">
        <thead><tr>
            <th>年度</th><th>S</th><th>A</th><th>B</th><th>C</th><th>D</th><th>總計</th>
        </tr></thead>
        <tbody id="yearly-grade-body"></tbody>
    </table>
    </div>

    <p class="grade-stats-note">
        SL% = (進場價 - 停損價) / 進場價。SL% 越低代表停損越緊、單筆風險越低。<br>
        評級基於進場時的原始 ATR 止損距離計算 (SL = 進場價 - 1.3×ATR)，反映該筆交易的風險程度。全部 452 筆交易均有完整 ATR 數據，可精確計算原始 SL%。<br>
        注意：S/D 級樣本極少 (S: 31 筆, D: 4 筆)，統計參考價值有限；A/B 為主力分佈 (共 366 筆, 81%)，統計較穩定。
    </p>
</div>

<!-- Table -->
<div id="table-container" role="region" aria-live="polite" aria-label="追蹤資料">
    <p class="loading">載入資料中...</p>
</div>

<div class="footer">
    <a href="index.html" style="color:var(--accent);text-decoration:none">&larr; 系統文件</a> &nbsp;|&nbsp;
    <a href="picks.html" style="color:var(--accent);text-decoration:none">每日選股</a> &nbsp;|&nbsp;
    <a href="news.html" style="color:var(--accent);text-decoration:none">整點快報 &rarr;</a>
    <p style="margin-top:8px">Sovereign V25 — 每日 #1 選股後續追蹤</p>
    <p style="margin-top:4px">資料每日自動更新 | 進場價為訊號日次日開盤模擬進場</p>
    <p id="site-updated" style="margin-top:6px;font-size:0.8em;color:var(--text-dim)"></p>
</div>

</div>

<script>
const DATA_URL = 'data/track.json';

function escHtml(str) {
    if (str == null) return '';
    const div = document.createElement('div');
    div.textContent = String(str);
    return div.innerHTML;
}

function safeFmt(n) {
    return (n != null && !isNaN(n)) ? n.toFixed(2) : '--';
}

// ── Grade System ──────────────────────────────
// SL% = (Entry - SL) / Entry × 100
// S: SL% <= 5% | A: SL% <= 8% | B: SL% <= 12% | C: SL% <= 18% | D: SL% > 18%
function calcGrade(entry, tp, sl) {
    if (!entry || entry <= 0 || !sl || sl <= 0) return { slPct: 0, grade: '?' };
    const slPct = Math.max(0, (entry - sl) / entry * 100);
    let grade;
    if (slPct <= 5)       grade = 'S';
    else if (slPct <= 8)  grade = 'A';
    else if (slPct <= 12) grade = 'B';
    else if (slPct <= 18) grade = 'C';
    else                  grade = 'D';
    return { slPct: Math.round(slPct * 10) / 10, grade };
}

// ── Historical Grade Stats (V25 全美股回測, 452 trades) ──
// Grade = SL% from original ATR-based stop: SL = entry - 1.3×ATR (capped at -20%)
// S(<=5%) | A(<=8%) | B(<=12%) | C(<=18%) | D(>18%)
const HIST = {
    overall: {
        S: { count: 31, wins: 13, wr: 41.9, avg_ret: 0.73, tp_rate: 6 },
        A: { count: 175, wins: 114, wr: 65.1, avg_ret: 3.57, tp_rate: 18 },
        B: { count: 191, wins: 130, wr: 68.1, avg_ret: 4.27, tp_rate: 24 },
        C: { count: 51, wins: 41, wr: 80.4, avg_ret: 7.03, tp_rate: 43 },
        D: { count: 4, wins: 4, wr: 100.0, avg_ret: 9.25, tp_rate: 50 },
    },
    yearly: {
        '2021': { S:{n:9,wr:44.4}, A:{n:33,wr:72.7}, B:{n:41,wr:70.7}, C:{n:7,wr:57.1}, D:{n:1,wr:100.0}, total:{n:91,wr:68.1} },
        '2022': { S:{n:11,wr:45.5}, A:{n:43,wr:53.5}, B:{n:28,wr:60.7}, C:{n:4,wr:75.0}, D:{n:0,wr:0}, total:{n:86,wr:55.8} },
        '2023': { S:{n:3,wr:33.3}, A:{n:29,wr:65.5}, B:{n:39,wr:64.1}, C:{n:11,wr:90.9}, D:{n:1,wr:100.0}, total:{n:83,wr:67.5} },
        '2024': { S:{n:4,wr:25.0}, A:{n:37,wr:59.5}, B:{n:36,wr:72.2}, C:{n:16,wr:87.5}, D:{n:0,wr:0}, total:{n:93,wr:67.7} },
        '2025': { S:{n:3,wr:66.7}, A:{n:31,wr:77.4}, B:{n:43,wr:69.8}, C:{n:12,wr:75.0}, D:{n:2,wr:100.0}, total:{n:91,wr:73.6} },
        '2026': { S:{n:1,wr:0.0}, A:{n:2,wr:100.0}, B:{n:4,wr:75.0}, C:{n:1,wr:100.0}, D:{n:0,wr:0}, total:{n:8,wr:75.0} },
    },
    total_trades: 452
};

const GRADE_META = {
    S: { range: 'SL% <= 5%', note: '極低風險 — 停損極緊，波動度低' },
    A: { range: 'SL% 5-8%', note: '低風險 — 停損緊密' },
    B: { range: 'SL% 8-12%', note: '中等風險 — 標準設定' },
    C: { range: 'SL% 12-18%', note: '偏高風險 — 停損較寬' },
    D: { range: 'SL% > 18%', note: '高風險 — 停損很寬，波動大' },
};

function checkTrackFreshness(updated) {
    if (!updated) return;
    // If no timezone info, treat as local time explicitly (Python isoformat() has no tz)
    const raw = String(updated);
    const hasZ = raw.endsWith('Z') || /[+-]\d{2}:\d{2}$/.test(raw);
    const ts = hasZ ? new Date(raw) : new Date(raw + '+08:00');
    const now = new Date();
    const ageH = (now - ts) / 3600000;
    if (ageH > 24) {
        const dateStr = ts.toLocaleDateString('zh-TW', {year:'numeric',month:'2-digit',day:'2-digit'});
        const timeStr = ts.toLocaleTimeString('zh-TW', {hour:'2-digit',minute:'2-digit'});
        const banner = document.getElementById('stale-banner');
        const msg = document.getElementById('stale-msg');
        msg.textContent = `追蹤資料已超過 24 小時未更新（最後更新: ${dateStr} ${timeStr}）`;
        banner.style.display = 'block';
    }
}

async function loadTrack() {
    try {
        const resp = await fetch(DATA_URL + '?t=' + Date.now());
        if (!resp.ok) throw new Error('Failed to load');
        const data = await resp.json();
        checkTrackFreshness(data.updated);
        renderSummary(data.summary);
        renderTable(data.tracks);
        renderSubtitle(data);
        renderGradeStats(data.tracks);
    } catch (e) {
        document.getElementById('table-container').innerHTML =
            '<p class="loading">無法載入資料</p>';
    }
}

function renderSubtitle(data) {
    if (!data || !data.updated || !data.tracks) {
        document.getElementById('subtitle').textContent = '無資料';
        return;
    }
    const updated = new Date(data.updated);
    const dateStr = updated.toLocaleDateString('zh-TW', {year:'numeric',month:'2-digit',day:'2-digit'});
    const timeStr = updated.toLocaleTimeString('zh-TW', {hour:'2-digit',minute:'2-digit'});
    document.getElementById('subtitle').textContent =
        `最近 ${data.tracks.length} 個交易日 | 更新: ${dateStr} ${timeStr}`;
}

function renderSummary(s) {
    if (!s || s.win_rate == null) return;
    const wrEl = document.getElementById('s-wr');
    wrEl.textContent = s.win_rate + '%';
    wrEl.className = 'value ' + (s.win_rate >= 50 ? 'green' : 'red');

    const beStr = s.be ? ` / <span style="color:var(--text-dim)">${s.be}BE</span>` : '';
    document.getElementById('s-wl').innerHTML =
        `<span style="color:var(--green)">${s.wins}</span> / <span style="color:var(--red)">${s.losses}</span>${beStr}`;

    const avgEl = document.getElementById('s-avg');
    avgEl.textContent = (s.avg_return >= 0 ? '+' : '') + s.avg_return + '%';
    avgEl.className = 'value ' + (s.avg_return >= 0 ? 'green' : 'red');

    const openEl = document.getElementById('s-open');
    openEl.textContent = s.open;
    openEl.className = 'value accent';
}

function renderTable(tracks) {
    let html = `<div class="table-wrap"><table class="track-table">
    <thead><tr>
        <th>#</th>
        <th>日期</th>
        <th>代碼</th>
        <th>評級</th>
        <th>進場</th>
        <th class="hide-mobile">停利</th>
        <th class="hide-mobile">停損</th>
        <th>出場/現價</th>
        <th>報酬</th>
        <th>狀態</th>
        <th class="hide-mobile">天數</th>
    </tr></thead><tbody>`;

    tracks.forEach((t, i) => {
        const ret = (t.return_pct != null && !isNaN(t.return_pct)) ? t.return_pct : 0;
        const retClass = ret > 0 ? 'ret-pos' : ret < 0 ? 'ret-neg' : 'ret-zero';
        const retStr = (ret >= 0 ? '+' : '') + ret.toFixed(2) + '%';

        const { slPct, grade } = calcGrade(t.entry, t.tp, t.sl);
        const gradeHtml = `<span class="grade grade-${escHtml(grade)}" title="SL%: ${slPct}%">${escHtml(grade)}</span>`;

        let statusBadge, exitPrice;
        const exitTypeTag = t.exit_type ? ' <span style="font-size:0.7em;color:var(--text-dim)">' + escHtml(t.exit_type) + '</span>' : '';
        if (t.status === 'WIN') {
            statusBadge = '<span class="badge badge-win">WIN</span>' + exitTypeTag;
            exitPrice = '$' + safeFmt(t.exit_price);
        } else if (t.status === 'LOSS') {
            statusBadge = '<span class="badge badge-loss">LOSS</span>' + exitTypeTag;
            exitPrice = '$' + safeFmt(t.exit_price);
        } else if (t.status === 'BE') {
            statusBadge = '<span class="badge badge-be">BE</span>' + exitTypeTag;
            exitPrice = '$' + safeFmt(t.exit_price);
        } else if (t.status === 'OPEN') {
            statusBadge = '<span class="badge badge-open">OPEN</span>';
            exitPrice = '$' + safeFmt(t.current || t.entry);
        } else if (t.status === 'PENDING') {
            statusBadge = '<span class="badge badge-pending">PENDING</span>';
            exitPrice = '--';
        } else {
            statusBadge = '<span class="badge">' + escHtml(t.status) + '</span>';
            exitPrice = '--';
        }

        html += `<tr>
            <td style="color:var(--text-dim)">${i + 1}</td>
            <td class="mono">${escHtml((t.date || '').slice(5))}</td>
            <td class="sym">${escHtml(t.symbol)}</td>
            <td>${gradeHtml}</td>
            <td class="mono">$${safeFmt(t.entry)}</td>
            <td class="mono hide-mobile">$${safeFmt(t.tp)}</td>
            <td class="mono hide-mobile">$${safeFmt(t.sl)}</td>
            <td class="mono">${exitPrice}</td>
            <td class="${retClass}">${retStr}</td>
            <td>${statusBadge}</td>
            <td class="hide-mobile">${t.days || 0}d</td>
        </tr>`;
    });

    html += '</tbody></table></div>';
    document.getElementById('table-container').innerHTML = html;
}

function renderGradeStats(tracks) {
    const container = document.getElementById('grade-stats');
    const tbody = document.getElementById('grade-stats-body');
    const grades = ['S', 'A', 'B', 'C', 'D'];
    let html = '';

    // ── Overall stats from historical backtest ──
    grades.forEach(g => {
        const h = HIST.overall[g];
        const wrClass = h.count > 0 ? (h.wr >= 65 ? 'ret-pos' : h.wr < 55 ? 'ret-neg' : '') : '';
        const avgClass = h.count > 0 ? (h.avg_ret > 0 ? 'ret-pos' : h.avg_ret < 0 ? 'ret-neg' : '') : '';
        const countNote = h.count < 10 ? ' *' : '';
        html += `<tr>
            <td><span class="grade grade-${g}">${g}</span></td>
            <td style="font-size:0.8em;color:var(--text-dim)">${GRADE_META[g].range}</td>
            <td>${h.count}${countNote}</td>
            <td class="${wrClass}" style="font-weight:600">${h.wr.toFixed(1)}%</td>
            <td>${h.tp_rate}%</td>
            <td class="${avgClass}">${h.avg_ret >= 0 ? '+' : ''}${h.avg_ret.toFixed(2)}%</td>
            <td style="font-size:0.78em;color:var(--text-dim);text-align:left">${GRADE_META[g].note}</td>
        </tr>`;
    });

    // Total row
    html += `<tr style="font-weight:700;border-top:2px solid var(--border)">
        <td>ALL</td>
        <td></td>
        <td>${HIST.total_trades}</td>
        <td>66.8%</td>
        <td>23%</td>
        <td>+4.11%</td>
        <td style="font-size:0.78em;color:var(--text-dim);text-align:left">2021-2026 全部交易 (* 樣本 < 10)</td>
    </tr>`;

    tbody.innerHTML = html;

    // ── Yearly breakdown ──
    const yearlyBody = document.getElementById('yearly-grade-body');
    let yearHtml = '';
    const years = ['2021', '2022', '2023', '2024', '2025', '2026'];

    years.forEach(yr => {
        const yd = HIST.yearly[yr];
        yearHtml += `<tr><td style="font-weight:600">${yr}</td>`;
        grades.forEach(g => {
            const gd = yd[g];
            if (gd.n === 0) {
                yearHtml += `<td style="color:var(--text-dim)">--</td>`;
            } else {
                const cls = gd.wr >= 65 ? 'ret-pos' : gd.wr < 50 ? 'ret-neg' : '';
                yearHtml += `<td class="${cls}">${gd.wr.toFixed(0)}% <span style="color:var(--text-dim);font-size:0.8em">(${gd.n})</span></td>`;
            }
        });
        const t = yd.total;
        const tCls = t.wr >= 65 ? 'ret-pos' : t.wr < 50 ? 'ret-neg' : '';
        yearHtml += `<td class="${tCls}" style="font-weight:600">${t.wr.toFixed(1)}% <span style="color:var(--text-dim);font-size:0.8em">(${t.n})</span></td>`;
        yearHtml += `</tr>`;
    });

    yearlyBody.innerHTML = yearHtml;
    container.style.display = 'block';
}

loadTrack();
</script>

<button class="scroll-top" id="scrollTop" aria-label="回到頂部">&uarr;</button>
<script>
const scrollBtn = document.getElementById('scrollTop');
if(scrollBtn) scrollBtn.addEventListener('click', () => window.scrollTo({top:0,behavior:'smooth'}));
if(scrollBtn) window.addEventListener('scroll', () => {
    scrollBtn.classList.toggle('show', window.scrollY > 300);
});

// ── Site Info: 更新時間戳 + Nav Brand ──
// Mobile hamburger menu toggle
document.querySelector('.menu-toggle')?.addEventListener('click', function() {
    const nav = document.querySelector('.nav-links');
    const open = nav.classList.toggle('open');
    this.setAttribute('aria-expanded', open);
    this.innerHTML = open ? '&times;' : '&#9776;';
});
fetch('data/site-info.json?t='+Date.now()).then(r=>r.json()).then(info=>{
    const b=document.querySelector('.brand');if(b)b.textContent=info.label;
    const ts=info.updated&&info.updated.track;
    if(ts){const d=new Date(ts);document.getElementById('site-updated').textContent='最後更新：'+d.toLocaleDateString('zh-TW',{year:'numeric',month:'2-digit',day:'2-digit'})+' '+d.toLocaleTimeString('zh-TW',{hour:'2-digit',minute:'2-digit',hour12:false});}
}).catch(()=>{});
document.querySelector('.close-btn')?.addEventListener('click',function(){this.parentElement.style.display='none';});
</script>
</main>
</body>
</html>
